<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Sleep Survey</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="survey-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Sleep Survey</ion-title>
    </ion-toolbar>
  </ion-header>

  <form (ngSubmit)="onSubmit()" #surveyForm="ngForm">

    <!-- Section 2: Behavioral Factors -->
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">Section 2: Behavioral Factors</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <!-- Sleep Hours -->
        <div class="question-group">
          <ion-label class="question-label">
            How many hours did you sleep last night? <span class="required">*</span>
          </ion-label>
          <ion-radio-group [(ngModel)]="surveyData.sleep_hours" name="sleep_hours" required>
            <ion-item>
              <ion-radio slot="start" value="Less than 4 hours"></ion-radio>
              <ion-label>Less than 4 hours</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="4-6 hours"></ion-radio>
              <ion-label>4-6 hours</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="6-8 hours"></ion-radio>
              <ion-label>6-8 hours</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="More than 8 hours"></ion-radio>
              <ion-label>More than 8 hours</ion-label>
            </ion-item>
          </ion-radio-group>
        </div>

        <!-- Interest Rating -->
        <div class="question-group">
          <ion-label class="question-label">
            How would you rate your interest during classes? <span class="required">*</span>
          </ion-label>
          <p class="question-subtitle">
            (1 star = Not Interested, 2 star = Neutral, 3 star = Interested, 4 star = Very Interested)
          </p>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('interest_rate') === i"
                (click)="onRatingChange('interest_rate', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Seating Position -->
        <div class="question-group">
          <ion-label class="question-label">
            Where are you seated in class today? <span class="required">*</span>
          </ion-label>
          <ion-radio-group [(ngModel)]="surveyData.position" name="position" required>
            <ion-item>
              <ion-radio slot="start" value="Front Row"></ion-radio>
              <ion-label>Front Row</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="Middle"></ion-radio>
              <ion-label>Middle</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="Back Row"></ion-radio>
              <ion-label>Back Row</ion-label>
            </ion-item>
          </ion-radio-group>
        </div>

        <!-- Screen Time -->
        <div class="question-group">
          <ion-label class="question-label">
            How many hours did you use a screen/device (e.g., phone, laptop) last night before sleep? <span class="required">*</span>
          </ion-label>
          <ion-radio-group [(ngModel)]="surveyData.screen_time" name="screen_time" required>
            <ion-item>
              <ion-radio slot="start" value="Less than 1 hour"></ion-radio>
              <ion-label>Less than 1 hour</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="1-2 hours"></ion-radio>
              <ion-label>1-2 hours</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="2-3 hours"></ion-radio>
              <ion-label>2-3 hours</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="More than 4 hours"></ion-radio>
              <ion-label>More than 4 hours</ion-label>
            </ion-item>
          </ion-radio-group>
        </div>

        <!-- Academic Pressure -->
        <div class="question-group">
          <ion-label class="question-label">
            How much academic pressure are you currently experiencing? (eg. projects, assignments) <span class="required">*</span>
          </ion-label>
          <ion-radio-group [(ngModel)]="surveyData.acad_pressure" name="acad_pressure" required>
            <ion-item>
              <ion-radio slot="start" value="None"></ion-radio>
              <ion-label>None</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="Mild"></ion-radio>
              <ion-label>Mild</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="Moderate"></ion-radio>
              <ion-label>Moderate</ion-label>
            </ion-item>
            <ion-item>
              <ion-radio slot="start" value="Severe"></ion-radio>
              <ion-label>Severe</ion-label>
            </ion-item>
          </ion-radio-group>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Sleep Quality Scale -->
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">Sleep Quality Scale (SQS)</ion-card-title>
        <ion-card-subtitle>Please rate the following based on your experience over the past week:</ion-card-subtitle>
        <p class="rating-guide">(1 - Rarely, 2 - Sometimes, 3 - Often, 4 - Almost Always)</p>
      </ion-card-header>

      <ion-card-content>
        <!-- Difficulty Falling Asleep -->
        <div class="question-group">
          <ion-label class="question-label">
            I have difficulty falling asleep. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('difficulty_falling_asleep') === i"
                (click)="onRatingChange('difficulty_falling_asleep', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Waking Up -->
        <div class="question-group">
          <ion-label class="question-label">
            I wake up while sleeping (e.g., suddenly waking up in the middle of the night). <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('waking_up') === i"
                (click)="onRatingChange('waking_up', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Difficulty Getting Back to Sleep -->
        <div class="question-group">
          <ion-label class="question-label">
            I have difficulty getting back to sleep. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('diff_back_to_sleep') === i"
                (click)="onRatingChange('diff_back_to_sleep', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Toss and Turn -->
        <div class="question-group">
          <ion-label class="question-label">
            I toss and turn. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('toss_turn') === i"
                (click)="onRatingChange('toss_turn', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Feel Unrefreshed -->
        <div class="question-group">
          <ion-label class="question-label">
            I feel unrefreshed after sleeping. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('unrefreshed') === i"
                (click)="onRatingChange('unrefreshed', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Headaches -->
        <div class="question-group">
          <ion-label class="question-label">
            Poor sleep gives me headaches. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('head_aches') === i"
                (click)="onRatingChange('head_aches', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Irritated -->
        <div class="question-group">
          <ion-label class="question-label">
            Poor sleep makes me irritated. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('irritated') === i"
                (click)="onRatingChange('irritated', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Sleepiness Intervenes -->
        <div class="question-group">
          <ion-label class="question-label">
            Sleepiness intervenes with my daily life. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('intervenes') === i"
                (click)="onRatingChange('intervenes', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Getting Out of Bed -->
        <div class="question-group">
          <ion-label class="question-label">
            I have difficulty getting out of bed. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('getting_out_of_bed') === i"
                (click)="onRatingChange('getting_out_of_bed', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Concentration -->
        <div class="question-group">
          <ion-label class="question-label">
            Poor sleep makes it hard to concentrate in class. <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('concentration') === i"
                (click)="onRatingChange('concentration', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Contextual Variables -->
    <ion-card>
      <ion-card-header>
        <ion-card-title color="primary">Contextual Variables</ion-card-title>
        <ion-card-subtitle>Rate your classroom environment today:</ion-card-subtitle>
        <p class="rating-guide">(1 - Very Poor, 5 - Excellent)</p>
      </ion-card-header>

      <ion-card-content>
        <!-- Temperature -->
        <div class="question-group">
          <ion-label class="question-label">
            Temperature: <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4,5]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('temp') === i"
                (click)="onRatingChange('temp', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Ventilation -->
        <div class="question-group">
          <ion-label class="question-label">
            Ventilation: <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4,5]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('ventilation') === i"
                (click)="onRatingChange('ventilation', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Noise Level -->
        <div class="question-group">
          <ion-label class="question-label">
            Noise Level: <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4,5]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('noise_level') === i"
                (click)="onRatingChange('noise_level', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Lighting -->
        <div class="question-group">
          <ion-label class="question-label">
            Lighting: <span class="required">*</span>
          </ion-label>
          <div class="star-rating">
            <div class="star-option" *ngFor="let i of [1,2,3,4,5]">
              <span class="star-number">{{i}}</span>
              <ion-button
                fill="clear"
                class="star-btn"
                [class.active]="getRatingValue('lighting') === i"
                (click)="onRatingChange('lighting', i)">
                <ion-icon name="star" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>

        <!-- Experiences -->
        <div class="question-group">
          <ion-label class="question-label">
            Do you currently experience any of the following? <span class="required">*</span>
          </ion-label>
          <p class="question-subtitle">(Check all that apply)</p>

          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="isExperienceSelected('Sleep disorder(e.g., insomnia, sleep apnea)')"
              (ionChange)="onExperienceChange('Sleep disorder(e.g., insomnia, sleep apnea)', $event.detail.checked)">
            </ion-checkbox>
            <ion-label>Sleep disorder(e.g., insomnia, sleep apnea)</ion-label>
          </ion-item>

          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="isExperienceSelected('Health condition affecting sleep')"
              (ionChange)="onExperienceChange('Health condition affecting sleep', $event.detail.checked)">
            </ion-checkbox>
            <ion-label>Health condition affecting sleep</ion-label>
          </ion-item>

          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="isExperienceSelected('Part-time job affecting schedule')"
              (ionChange)="onExperienceChange('Part-time job affecting schedule', $event.detail.checked)">
            </ion-checkbox>
            <ion-label>Part-time job affecting schedule</ion-label>
          </ion-item>

          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="isExperienceSelected('Lifestyle habits (e.g., staying up late, caffeine)')"
              (ionChange)="onExperienceChange('Lifestyle habits (e.g., staying up late, caffeine)', $event.detail.checked)">
            </ion-checkbox>
            <ion-label>Lifestyle habits (e.g., staying up late, caffeine)</ion-label>
          </ion-item>

          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="isExperienceSelected('None')"
              (ionChange)="onExperienceChange('None', $event.detail.checked)">
            </ion-checkbox>
            <ion-label>None</ion-label>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Submit Button -->
    <div class="submit-section">
      <ion-button
        expand="block"
        type="submit"
        [disabled]="!isFormValid()"
        color="primary">
        <ion-icon name="checkmark-circle" slot="start"></ion-icon>
        Submit Survey
      </ion-button>
    </div>

  </form>
</ion-content>
